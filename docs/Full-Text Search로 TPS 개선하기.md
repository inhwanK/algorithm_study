## Full-Text Search로 TPS 개선하기
과거에 진행했던 프로젝트 리팩토링을 하면서 인덱스를 쓰지 않는 쿼리를 개선해보았다.  
  
### 인덱스를 쓰지 않는 쿼리
  
개선 대상은 특정 키워드로 게시글을 검색하는 쿼리였다. 이 쿼리는 where 절에 like 문과 와일드 카드를 통해 키워드 조건을 걸려 있었다.
이는 인덱스를 사용하지 않아 성능이 좋지 않을 것으로 예상했다. 해당 쿼리의 실행계획을 보면 type 값이 ALL 로 풀 테이블 스캔을 하는 것을 볼 수 있다.
  
![img.png](img/Full-Text%20Search로%20TPS%20개선하기_img1.png)  
  

#### 성능 테스트

- DB 데이터 1만 건
- VUser 500명
- 30분간 수행


인덱스를 사용하지 않아 성능이 좋지 않은 방법이었다.  
그러나, 해당 쿼리에서 조건으로 쓰는 컬럼은 `TEXT`타입이어서 인덱스를 사용할 수 있는지 몰랐다. 
이를 개선하기 위해 인덱스를 활용하는 방법을 찾아봤으나, 해당 쿼리에서 조건으로 쓰는 컬럼은 `TEXT`타입이어서 인덱스

것이었다. 개선해야할 점이라고 느낀 부분은 like 문과 와일드 카드를 사용, 이는 인덱스를 타지 않는 쿼리문이었다.

이를 개선하기 위한 다양한 방법이 있었다.

개발자 커뮤니티 대시보드 프로젝트에서 사용자의 질문을 검색하는 API를 구현하였습니다. 당시, 검색어 조건을 'like'문과 와일드카드를 사용하여 검색 쿼리를 작성하였습니다. 하지만, 이러한 쿼리는 인덱스를 사용하지 않아 성능이 좋지 않다는 것을 알게 되었습니다.
쿼리 개선 방법을 조사해본 결과, MySql에서 제공하는 Full-Text Search를 활용한 방법을 알게 되었습니다. 이를 활용하기 위해 먼저, Full-Text Search로 활용할 인덱스를 생성하였습니다. 이후 JPA 대신 Native 쿼리를 사용하여 match, against 구문을 사용해 조건절을 작성하였습니다.
이후 약 5만건의 데이터, 500명의 유저로 각각 30분간 테스트해본 결과, 평균 TPS가 36.6에서 313.1로 향상할 수 있었습니다.

![img.png](img/Full-Text%20Search로%20TPS%20개선하기_img2.png)  
  
  
![img.png](img/Full-Text%20Search로%20TPS%20개선하기_img3.png)  
