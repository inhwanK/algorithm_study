## Full-Text Search로 TPS 개선하기

과거에 진행했던 프로젝트 리팩토링을 진행하면서 검색 쿼리의 성능을 개선해보았다.  
  
### 인덱스를 쓰지 않는 쿼리
  
개선 대상은 특정 키워드로 게시글을 조회하는 쿼리다. 이 쿼리는 where 절에 like 문과 와일드 카드로 조건이 걸려 있었다.  
해당 쿼리의 실행계획을 보면 type 값이 ALL 로 풀 테이블 스캔을 한다. 즉, 인덱스를 쓰지 않는다.  
  
![img.png](img/Full-Text%20Search로%20TPS%20개선하기_img1.png)  
  

#### 성능 테스트
  
추가로 nGrinder를 이용해 대상 API에 대해 부하 테스트를 진행했다.  
  
- DB 데이터 1만 건
- VUser 500명
- 20분간 수행

![img.png](img/Full-Text%20Search로%20TPS%20개선하기_img4.png)  
  
어떤 단어로 검색하느냐에 따라 차이가 있었지만, 대체로 평균 TPS 30 ~ 45 사이의 성능을 보였다.  
  
### Full-Text Search Index

개선 방법에는 여러가지가 있겠지만 인덱스를 사용하기는 어려워 보였다. TEXT 열에는 무수히 많은 문자열 조합이 가능할텐데, 모든 가능한 문자열에 대해 인덱스 생성하는 것은 어려울거라고 생각했기 때문이다.  
  
그러나 mysql에서는 이러한 


개발자 커뮤니티 대시보드 프로젝트에서 사용자의 질문을 검색하는 API를 구현하였습니다. 당시, 검색어 조건을 'like'문과 와일드카드를 사용하여 검색 쿼리를 작성하였습니다. 하지만, 이러한 쿼리는 인덱스를 사용하지 않아 성능이 좋지 않다는 것을 알게 되었습니다.
쿼리 개선 방법을 조사해본 결과, MySql에서 제공하는 Full-Text Search를 활용한 방법을 알게 되었습니다. 이를 활용하기 위해 먼저, Full-Text Search로 활용할 인덱스를 생성하였습니다. 이후 JPA 대신 Native 쿼리를 사용하여 match, against 구문을 사용해 조건절을 작성하였습니다.
이후 약 5만건의 데이터, 500명의 유저로 각각 30분간 테스트해본 결과, 평균 TPS가 36.6에서 313.1로 향상할 수 있었습니다.

![img.png](img/Full-Text%20Search로%20TPS%20개선하기_img2.png)  
  
  
![img.png](img/Full-Text%20Search로%20TPS%20개선하기_img3.png)  
